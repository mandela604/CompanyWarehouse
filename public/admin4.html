<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Layaway / Partial Payment Demo – Outlet Rep</title>
  <style>
    :root {
      --blue: #0b5ed7;
      --green: #10b981;
      --red: #dc3545;
      --gray: #6b7280;
      --light: #f8fafc;
      --bg: #f1f5f9;
    }
    body {
      font-family: system-ui, sans-serif;
      background: var(--bg);
      margin: 0;
      padding: 20px;
      color: #1f2937;
    }
    h1, h2 { color: var(--blue); }
    .container { max-width: 1100px; margin: 0 auto; }
    .card {
      background: white;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.08);
      padding: 20px;
      margin-bottom: 24px;
    }
    .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 20px; margin: 24px 0; }
    .stat {
      text-align: center;
      padding: 16px;
      border-radius: 10px;
      background: var(--light);
    }
    .stat strong { font-size: 2rem; display: block; margin: 8px 0; }
    button {
      padding: 10px 16px;
      border: none;
      border-radius: 8px;
      font-weight: 600;
      cursor: pointer;
    }
    .btn-primary { background: var(--blue); color: white; }
    .btn-success { background: var(--green); color: white; }
    .btn-danger { background: var(--red); color: white; }
    .btn-outline { border: 1px solid var(--gray); background: white; color: var(--gray); }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 16px;
    }
    th, td {
      padding: 12px;
      text-align: left;
      border-bottom: 1px solid #e5e7eb;
    }
    th { background: #f1f5f9; font-weight: 600; }
    .status {
      padding: 4px 10px;
      border-radius: 999px;
      font-size: 0.85rem;
      font-weight: 600;
      display: inline-block;
    }
    .status-pending { background: #fef3c7; color: #92400e; }
    .status-paid-hold { background: #d1fae5; color: #065f46; }
    .status-completed { background: #dbeafe; color: #1e40af; }
    .modal {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.5);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
    }
    .modal-content {
      background: white;
      border-radius: 12px;
      width: 90%;
      max-width: 500px;
      max-height: 90vh;
      overflow-y: auto;
      padding: 24px;
    }
    .form-group { margin-bottom: 16px; }
    label { display: block; margin-bottom: 6px; font-weight: 600; }
    input, select {
      width: 100%;
      padding: 10px;
      border: 1px solid #d1d5db;
      border-radius: 6px;
      font-size: 1rem;
    }
    .items-table th, .items-table td { text-align: center; }
    .total-line {
      font-size: 1.3rem;
      font-weight: bold;
      margin: 16px 0;
      text-align: right;
    }
    .hidden { display: none !important; }
  </style>
</head>
<body>

<div class="container">
  <h1>Layaway / Partial Payment Demo</h1>
  <p style="color: var(--gray);">Outlet Rep – Simple simulation (data in browser memory)</p>

  <div class="grid">
    <div class="stat">
      <div>Pending Orders</div>
      <strong id="pendingCount">0</strong>
    </div>
    <div class="stat">
      <div>Total Outstanding Balance</div>
      <strong id="totalBalance">₦0</strong>
    </div>
    <div class="stat">
      <div>Held Goods Value</div>
      <strong id="heldValue">₦0</strong>
    </div>
  </div>

  <div class="card">
    <button class="btn-primary" style="font-size:1.1rem; padding:14px 24px;" onclick="openNewOrderModal()">
      + New Order / Layaway
    </button>
  </div>

  <div class="card">
    <h2>Pending & Held Orders</h2>
    <table id="ordersTable">
      <thead>
        <tr>
          <th>ID</th>
          <th>Customer</th>
          <th>Items</th>
          <th>Total</th>
          <th>Paid</th>
          <th>Balance</th>
          <th>Status</th>
          <th>Action</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>
</div>

<!-- New Order Modal -->
<div class="modal hidden" id="newOrderModal">
  <div class="modal-content">
    <h2>New Order / Layaway</h2>
    <div class="form-group">
      <label>Customer Name (optional)</label>
      <input type="text" id="customerName" placeholder="e.g. Chinedu Okeke" />
    </div>

    <div class="form-group">
      <label>Add Products</label>
      <select id="productSelect">
        <option value="">Select product...</option>
        <option value="p1" data-name="Rice 50kg" data-price="85000">Rice 50kg – ₦85,000</option>
        <option value="p2" data-name="Palm Oil 25L" data-price="42000">Palm Oil 25L – ₦42,000</option>
        <option value="p3" data-name="Beans 50kg" data-price="65000">Beans 50kg – ₦65,000</option>
        <option value="p4" data-name="Garri 50kg" data-price="28000">Garri 50kg – ₦28,000</option>
      </select>
      <input type="number" id="qtyInput" min="1" value="1" placeholder="Quantity" style="width:80px; margin:0 8px;" />
      <button class="btn-outline" onclick="addItemToOrder()">+ Add</button>
    </div>

    <table class="items-table" style="width:100%; margin:16px 0;">
      <thead><tr><th>Product</th><th>Qty</th><th>Price</th><th>Total</th><th></th></tr></thead>
      <tbody id="orderItems"></tbody>
    </table>

    <div class="total-line">
      Grand Total: ₦<span id="orderTotal">0</span>
    </div>

    <div class="form-group">
      <label>Amount Paid Now (₦)</label>
      <input type="number" id="paidNow" min="0" value="0" step="1000" />
    </div>

    <div style="display:flex; gap:12px; justify-content:flex-end; margin-top:24px;">
      <button class="btn-outline" onclick="closeModal('newOrderModal')">Cancel</button>
      <button class="btn-primary" onclick="saveNewOrder()">Create Order</button>
    </div>
  </div>
</div>

<script>
// ── Demo Data & Storage ────────────────────────────────────────
let orders = JSON.parse(localStorage.getItem('layawayOrders')) || [
  {
    id: "ORD-001",
    customer: "Mrs Aisha Bello",
    items: [
      { name: "Rice 50kg", qty: 2, price: 85000, total: 170000 },
      { name: "Palm Oil 25L", qty: 1, price: 42000, total: 42000 }
    ],
    total: 212000,
    paid: 100000,
    balance: 112000,
    status: "pending_payment",
    date: "2025-01-28"
  },
  {
    id: "ORD-002",
    customer: "Chinedu Okeke",
    items: [
      { name: "Beans 50kg", qty: 3, price: 65000, total: 195000 }
    ],
    total: 195000,
    paid: 195000,
    balance: 0,
    status: "full_paid_pending_pickup",
    date: "2025-02-01"
  }
];

function saveOrders() {
  localStorage.setItem('layawayOrders', JSON.stringify(orders));
  renderOrders();
  updateStats();
}

function updateStats() {
  const pending = orders.filter(o => o.status !== 'completed').length;
  const balance = orders.reduce((sum, o) => sum + (o.balance || 0), 0);
  const heldValue = orders.reduce((sum, o) => {
    return o.status === 'full_paid_pending_pickup' ? sum + o.total : sum;
  }, 0);

  document.getElementById('pendingCount').textContent = pending;
  document.getElementById('totalBalance').textContent = '₦' + balance.toLocaleString();
  document.getElementById('heldValue').textContent = '₦' + heldValue.toLocaleString();
}

function renderOrders() {
  const tbody = document.querySelector('#ordersTable tbody');
  tbody.innerHTML = orders.map(order => {
    const statusClass = {
      pending_payment: 'status-pending',
      full_paid_pending_pickup: 'status-paid-hold',
      completed: 'status-completed'
    }[order.status] || '';

    return `
      <tr>
        <td>${order.id}</td>
        <td>${order.customer || '—'}</td>
        <td>${order.items.map(i => `${i.name} ×${i.qty}`).join('<br>')}</td>
        <td>₦${order.total.toLocaleString()}</td>
        <td>₦${order.paid.toLocaleString()}</td>
        <td style="color:${order.balance > 0 ? 'var(--red)' : 'var(--green)'}">
          ₦${order.balance.toLocaleString()}
        </td>
        <td><span class="status ${statusClass}">${order.status.replace(/_/g, ' ')}</span></td>
        <td>
          ${order.status !== 'completed' ? `
            <button class="btn-success" style="font-size:0.85rem;padding:6px 12px;"
                    onclick="completeOrder('${order.id}')">
              Pick Up
            </button>
          ` : '<small>Completed</small>'}
        </td>
      </tr>
    `;
  }).join('') || '<tr><td colspan="8" style="text-align:center;padding:40px;color:#888;">No orders yet</td></tr>';
}

// ── New Order Modal ─────────────────────────────────────────────
function openNewOrderModal() {
  document.getElementById('newOrderModal').classList.remove('hidden');
  document.getElementById('customerName').value = '';
  document.getElementById('paidNow').value = '0';
  document.getElementById('qtyInput').value = '1';
  document.getElementById('productSelect').value = '';
  currentOrderItems = [];
  updateOrderTotal();
  renderOrderItems();
}

function closeModal(id) {
  document.getElementById(id).classList.add('hidden');
}

let currentOrderItems = [];

function addItemToOrder() {
  const sel = document.getElementById('productSelect');
  const qty = parseInt(document.getElementById('qtyInput').value) || 1;
  if (!sel.value || qty < 1) return alert('Select product and enter qty');

  const opt = sel.options[sel.selectedIndex];
  const name = opt.dataset.name;
  const price = parseInt(opt.dataset.price);
  const total = qty * price;

  currentOrderItems.push({ name, qty, price, total });
  renderOrderItems();
  updateOrderTotal();

  sel.value = '';
  document.getElementById('qtyInput').value = '1';
}

function renderOrderItems() {
  const tbody = document.getElementById('orderItems');
  tbody.innerHTML = currentOrderItems.map((item, i) => `
    <tr>
      <td>${item.name}</td>
      <td>${item.qty}</td>
      <td>₦${item.price.toLocaleString()}</td>
      <td>₦${item.total.toLocaleString()}</td>
      <td><button onclick="removeOrderItem(${i})" style="color:var(--red);">×</button></td>
    </tr>
  `).join('') || '<tr><td colspan="5" style="text-align:center;color:#888;">No items added</td></tr>';
}

function removeOrderItem(index) {
  currentOrderItems.splice(index, 1);
  renderOrderItems();
  updateOrderTotal();
}

function updateOrderTotal() {
  const total = currentOrderItems.reduce((sum, i) => sum + i.total, 0);
  document.getElementById('orderTotal').textContent = total.toLocaleString();
}

// Save new order
function saveNewOrder() {
  if (currentOrderItems.length === 0) return alert('Add at least one item');

  const customer = document.getElementById('customerName').value.trim() || 'Walk-in';
  const paid = parseInt(document.getElementById('paidNow').value) || 0;
  const total = currentOrderItems.reduce((sum, i) => sum + i.total, 0);

  if (paid > total) return alert("Paid amount can't exceed total");

  const balance = total - paid;
  const status = balance === 0 ? 'full_paid_pending_pickup' : 'pending_payment';

  const newOrder = {
    id: 'ORD-' + String(Date.now()).slice(-6),
    customer,
    items: [...currentOrderItems],
    total,
    paid,
    balance,
    status,
    date: new Date().toISOString().split('T')[0]
  };

  orders.push(newOrder);
  saveOrders();
  closeModal('newOrderModal');
  alert('Order created successfully!');
  currentOrderItems = [];
}

// Complete / Pickup order
function completeOrder(orderId) {
  const order = orders.find(o => o.id === orderId);
  if (!order) return;

  if (order.balance > 0) {
    const payRest = confirm(`Balance ₦${order.balance.toLocaleString()} remaining.\nDoes customer want to pay now?`);
    if (!payRest) return;
    order.paid += order.balance;
    order.balance = 0;
  }

  order.status = 'completed';
  saveOrders();
  alert('Order completed – stock deducted (demo)');
}
  
// Initial render
renderOrders();
updateStats();
  </script>
</body>
</html>